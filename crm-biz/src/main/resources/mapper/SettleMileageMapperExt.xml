<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jaagro.crm.biz.mapper.SettleMileageMapperExt">
    <select id="getSettleMileageList" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM settle_mileage
        WHERE customer_contract_id = #{customerContractId}
        <if test="siteDtoList !=null and siteDtoList.size() > 0">
            and
            <foreach collection="siteDtoList" separator=") or (" item="site" open="((" close="))">
                load_site_id = #{site.loadSiteId} and unload_site_id = #{site.unloadSiteId}
            </foreach>
        </if>
    </select>
    <select id="listByCriteria" parameterType="com.jaagro.crm.api.dto.request.contract.listSettleMileageCriteriaDto"
            resultType="com.jaagro.crm.api.dto.response.contract.ReturnSettleMileageDto">
        SELECT
        <include refid="Base_Column_List"/>
        FROM settle_mileage
        WHERE enable = 1
        <if test="deptName != null and deptName != ''">
            <![CDATA[AND department_name like concat(#{deptName},'%') ]]>
        </if>
        <if test="deptId != null">
            AND department_id = #{deptId}
        </if>
        <if test="departIds != null and departIds.size() > 0">
            and department_id in
            <foreach collection="departIds" open="(" separator="," close=")" item="did">
                ${did}
            </foreach>
        </if>
    </select>
    <select id="selectByCriteria" parameterType="com.jaagro.crm.biz.entity.SettleMileage"
            resultType="java.lang.Integer">
        select
        id
        from
        settle_mileage
        where
        enable = 1
        <if test="loadSiteId != null">
            and load_site_id = #{loadSiteId}
        </if>
        <if test="unloadSiteId != null">
            and unload_site_id = #{unloadSiteId}
        </if>
        <if test="truckTypeId != null">
            and truck_type_id = #{truckTypeId}
        </if>
        limit 1
    </select>
    <select id="disableBySettlePriceId" parameterType="java.lang.Integer">
      update settle_mileage set enable = 0 where customer_settle_price_id = #{priceId}
    </select>
</mapper>